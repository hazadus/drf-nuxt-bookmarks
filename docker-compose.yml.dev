version: "3.9"
services:
  api:
    container_name: "bkmrks-api"
    build: ./backend/
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - ./backend:/code
    environment:
      - "SECRET_KEY=django-debug-secret-..."
      - "DEBUG=True"
      - "BACKEND_HOST=127.0.0.1"
      - "BACKEND_HOST_DOCKER=api"
    ports:
      - "8000:8000"
  bot:
    container_name: "bkmrks-bot"
    build: ./bot/
    command: python main.py
    volumes:
      - ./bot:/code
    environment:
      - "BOT_TOKEN="
      - "API_BASE_URL=http://api:8000"
  redis:
     container_name: "bkmrks-redis"
     image: redis:7.0.4
     volumes:
       - ./docker/redis/data/:/data
  worker:
     container_name: "bkmrks-worker"
     build: ./backend/
     volumes:
       - ./backend:/code
     command: ['celery', '--workdir=/code', '-A', 'django_project', 'worker']
     environment:
       - "DEBUG=True"
       - "TELEGRAM_BOT_TOKEN="